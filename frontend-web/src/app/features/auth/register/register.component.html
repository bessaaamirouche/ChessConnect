<div class="auth-page">
  <a routerLink="/" class="auth-page__logo">
    <img src="assets/logo.png" alt="mychess" class="auth-page__logo-img">
  </a>
  <div class="auth-card card">
    @if (success()) {
      <!-- Email Verification Required Screen -->
      <div class="register-success">
        <div class="register-success__icon register-success__icon--email">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="20" height="16" x="2" y="4" rx="2"/>
            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
          </svg>
        </div>
        <h1 class="heading-3">Verifiez votre email</h1>
        <p class="text-secondary">
          Un email de verification a ete envoye a<br>
          <strong class="text-gold">{{ registeredEmail() }}</strong>
        </p>

        <div class="register-success__info">
          <p>Cliquez sur le lien dans l'email pour activer votre compte et acceder a la plateforme.</p>
          <p class="text-warning-subtle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
              <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
              <path d="M12 9v4"/>
              <path d="M12 17h.01"/>
            </svg>
            Pensez a verifier vos spams si vous ne recevez pas l'email.
          </p>
          <small class="text-muted">Le lien expire dans 24 heures.</small>
        </div>

        <div class="register-success__actions">
          @if (resendSuccess()) {
            <div class="alert alert--success">
              Email renvoye ! Verifiez votre boite de reception.
            </div>
          }
          <button
            type="button"
            class="btn btn--outline btn--block"
            [disabled]="resendLoading()"
            (click)="resendVerificationEmail()"
          >
            @if (resendLoading()) {
              <span class="spinner spinner--sm"></span>
              Envoi en cours...
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
              </svg>
              Renvoyer l'email de verification
            }
          </button>
          <a routerLink="/login" class="btn btn--primary btn--block">
            <ng-icon name="heroArrowRight"></ng-icon>
            Aller a la page de connexion
          </a>
        </div>
      </div>
    } @else {
    <div class="auth-card__header">
      <h1 class="heading-3">Créer un compte</h1>
    </div>

    <div class="alert-inline-container">
      <div class="alert-inline alert-inline--error" [class.alert-inline--visible]="error()">
        <span>{{ error() }}</span>
      </div>
    </div>

    <!-- Role Selection -->
    <div class="role-selector" role="radiogroup" aria-label="Type de compte">
      <button
        type="button"
        class="role-btn"
        role="radio"
        [class.role-btn--active]="selectedRole() === 'STUDENT'"
        [attr.aria-checked]="selectedRole() === 'STUDENT'"
        (click)="selectRole('STUDENT')"
      >
        <span class="role-btn__icon" aria-hidden="true"><ng-icon name="heroUserGroup" size="28"></ng-icon></span>
        <span class="role-btn__label">Joueur</span>
        <span class="role-btn__desc">Je veux apprendre</span>
      </button>
      <button
        type="button"
        class="role-btn"
        role="radio"
        [class.role-btn--active]="selectedRole() === 'TEACHER'"
        [attr.aria-checked]="selectedRole() === 'TEACHER'"
        (click)="selectRole('TEACHER')"
      >
        <span class="role-btn__icon" aria-hidden="true"><ng-icon name="heroAcademicCap" size="28"></ng-icon></span>
        <span class="role-btn__label">Coach</span>
        <span class="role-btn__desc">Je veux enseigner</span>
      </button>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form">
      <div class="form-row">
        <div class="form-group">
          <label class="form-group__label" for="firstName">Prénom</label>
          <input
            type="text"
            id="firstName"
            formControlName="firstName"
            class="input"
            [class.input--error]="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched"
            placeholder="Jean"
          >
          @if (registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched) {
            <span class="form-group__error">Minimum 2 caractères</span>
          }
        </div>
        <div class="form-group">
          <label class="form-group__label" for="lastName">Nom</label>
          <input
            type="text"
            id="lastName"
            formControlName="lastName"
            class="input"
            [class.input--error]="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched"
            placeholder="Dupont"
          >
          @if (registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched) {
            <span class="form-group__error">Minimum 2 caractères</span>
          }
        </div>
      </div>

      <div class="form-group">
        <label class="form-group__label" for="email">Email</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="input"
          [class.input--error]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
          placeholder="jean.dupont@email.com"
        >
        @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
          <span class="form-group__error">Email invalide</span>
        }
      </div>

      <div class="form-group">
        <label class="form-group__label" for="password">Mot de passe</label>
        <div class="input-password-wrapper">
          <input
            [type]="showPassword() ? 'text' : 'password'"
            id="password"
            formControlName="password"
            class="input"
            [class.input--error]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
            placeholder="8 caractères minimum"
          >
          <button
            type="button"
            class="password-toggle"
            (click)="togglePassword()"
            [attr.aria-label]="showPassword() ? 'Masquer le mot de passe' : 'Afficher le mot de passe'"
            [attr.aria-pressed]="showPassword()"
          >
            @if (showPassword()) {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            }
          </button>
        </div>
        @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
          <span class="form-group__error">Minimum 8 caractères</span>
        }
      </div>

      @if (selectedRole() === 'STUDENT') {
        <div class="student-fields">
          <div class="form-group">
            <label class="form-group__label" for="birthDate">Date de naissance</label>
            <app-date-input
              formControlName="birthDate"
              [min]="'1920-01-01'"
              [max]="maxBirthDate"
            ></app-date-input>
          </div>

          <div class="form-group">
            <label class="checkbox">
              <input type="checkbox" formControlName="knowsElo">
              <span>Je connais mon classement ELO</span>
            </label>
          </div>

          <div class="elo-field-container">
            @if (registerForm.get('knowsElo')?.value) {
              <div class="form-group elo-field">
                <label class="form-group__label" for="eloRating">Classement ELO</label>
                <input
                  type="number"
                  id="eloRating"
                  formControlName="eloRating"
                  class="input"
                  min="100"
                  max="3000"
                  placeholder="Ex: 1200"
                >
                <small class="form-hint">Votre classement FIDE ou FFE</small>
              </div>
            }
          </div>
        </div>
      }

      @if (selectedRole() === 'TEACHER') {
        <div class="teacher-fields">
          <div class="form-group">
            <label class="form-group__label" for="hourlyRate">Tarif horaire (€)</label>
            <input
              type="number"
              id="hourlyRate"
              formControlName="hourlyRate"
              class="input"
              min="10"
              step="5"
              placeholder="50"
            >
          </div>

          <div class="form-group">
            <label class="checkbox">
              <input type="checkbox" formControlName="acceptsFreeTrial">
              <span>J'accepte de donner les cours d'initiation de 15 minutes gratuitement</span>
            </label>
          </div>

          <div class="form-group">
            <label class="form-group__label" for="bio">Bio</label>
            <textarea
              id="bio"
              formControlName="bio"
              class="textarea"
              rows="3"
              placeholder="Présentez-vous en quelques lignes..."
            ></textarea>
          </div>

          <div class="form-group">
            <label class="form-group__label" id="languages-label">Langues parlees</label>
            <div class="language-selector" role="group" aria-labelledby="languages-label">
              @for (lang of availableLanguages; track lang.code) {
                <button
                  type="button"
                  class="language-btn"
                  [class.language-btn--active]="isLanguageSelected(lang.code)"
                  [attr.aria-pressed]="isLanguageSelected(lang.code)"
                  (click)="toggleLanguage(lang.code)"
                >
                  {{ lang.name }}
                </button>
              }
            </div>
            <small class="form-hint">Selectionnez au moins une langue</small>
          </div>
        </div>
      }

      <button
        type="submit"
        class="btn btn--primary btn--block btn--lg"
        [disabled]="loading()"
      >
        @if (loading()) {
          <span class="spinner spinner--sm"></span>
          Création...
        } @else {
          Créer mon compte
        }
      </button>
    </form>

    <div class="auth-card__footer">
      <p>
        Déjà un compte ?
        <a routerLink="/login" class="text-gold">Se connecter</a>
      </p>
    </div>
    }
  </div>
</div>
