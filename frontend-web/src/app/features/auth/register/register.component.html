<div class="auth-page">
  <a routerLink="/" class="auth-page__logo">
    <img src="assets/logo.png" alt="mychess" class="auth-page__logo-img">
  </a>
  <div class="auth-card card">
    @if (success()) {
      <!-- Email Verification Required Screen -->
      <div class="register-success">
        <div class="register-success__icon register-success__icon--email">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="20" height="16" x="2" y="4" rx="2"/>
            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
          </svg>
        </div>
        <h1 class="heading-3">{{ 'auth.emailVerification.title' | translate }}</h1>
        <p class="text-secondary">
          {{ 'auth.emailVerification.subtitle' | translate }}<br>
          <strong class="text-gold">{{ registeredEmail() }}</strong>
        </p>

        <div class="register-success__info">
          <p>{{ 'auth.emailVerification.instructions' | translate }}</p>
          <p class="text-warning-subtle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
              <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
              <path d="M12 9v4"/>
              <path d="M12 17h.01"/>
            </svg>
            {{ 'auth.emailVerification.checkSpam' | translate }}
          </p>
          <small class="text-muted">{{ 'auth.emailVerification.linkExpires' | translate }}</small>
        </div>

        <div class="register-success__actions">
          @if (resendSuccess()) {
            <div class="alert alert--success">
              {{ 'auth.emailVerification.resendSuccess' | translate }}
            </div>
          }
          <button
            type="button"
            class="btn btn--outline btn--block"
            [disabled]="resendLoading()"
            (click)="resendVerificationEmail()"
          >
            @if (resendLoading()) {
              <span class="spinner spinner--sm"></span>
              {{ 'auth.emailVerification.resending' | translate }}
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
              </svg>
              {{ 'auth.emailVerification.resendButton' | translate }}
            }
          </button>
          <a routerLink="/login" class="btn btn--primary btn--block">
            <ng-icon name="heroArrowRight"></ng-icon>
            {{ 'auth.emailVerification.goToLogin' | translate }}
          </a>
        </div>
      </div>
    } @else {
    <div class="auth-card__header">
      <h1 class="heading-3">{{ 'auth.signup.title' | translate }}</h1>
    </div>

    <div class="alert-inline-container">
      <div class="alert-inline alert-inline--error" [class.alert-inline--visible]="error()">
        <span>{{ error() }}</span>
      </div>
    </div>

    <!-- Role Selection -->
    <div class="role-selector" role="radiogroup" [attr.aria-label]="'auth.signup.accountType' | translate">
      <button
        type="button"
        class="role-btn"
        role="radio"
        [class.role-btn--active]="selectedRole() === 'STUDENT'"
        [attr.aria-checked]="selectedRole() === 'STUDENT'"
        (click)="selectRole('STUDENT')"
      >
        <span class="role-btn__icon" aria-hidden="true"><ng-icon name="heroUserGroup" size="28"></ng-icon></span>
        <span class="role-btn__label">{{ 'auth.signup.playerLabel' | translate }}</span>
        <span class="role-btn__desc">{{ 'auth.signup.playerDesc' | translate }}</span>
      </button>
      <button
        type="button"
        class="role-btn"
        role="radio"
        [class.role-btn--active]="selectedRole() === 'TEACHER'"
        [attr.aria-checked]="selectedRole() === 'TEACHER'"
        (click)="selectRole('TEACHER')"
      >
        <span class="role-btn__icon" aria-hidden="true"><ng-icon name="heroAcademicCap" size="28"></ng-icon></span>
        <span class="role-btn__label">{{ 'auth.signup.coachLabel' | translate }}</span>
        <span class="role-btn__desc">{{ 'auth.signup.coachDesc' | translate }}</span>
      </button>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form">
      <div class="form-row">
        <div class="form-group">
          <label class="form-group__label" for="firstName">{{ 'auth.signup.firstName' | translate }}</label>
          <input
            type="text"
            id="firstName"
            formControlName="firstName"
            class="input"
            [class.input--error]="registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched"
            [placeholder]="'auth.signup.firstNamePlaceholder' | translate"
          >
          @if (registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched) {
            <span class="form-group__error">
              @if (registerForm.get('firstName')?.errors?.['required']) {
                {{ 'auth.signup.firstNameRequired' | translate }}
              } @else if (registerForm.get('firstName')?.errors?.['minlength']) {
                {{ 'auth.signup.minChars' | translate }}
              } @else if (registerForm.get('firstName')?.errors?.['invalidName']) {
                {{ 'auth.signup.specialCharsNotAllowed' | translate }}
              }
            </span>
          }
        </div>
        <div class="form-group">
          <label class="form-group__label" for="lastName">{{ 'auth.signup.lastName' | translate }}</label>
          <input
            type="text"
            id="lastName"
            formControlName="lastName"
            class="input"
            [class.input--error]="registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched"
            [placeholder]="'auth.signup.lastNamePlaceholder' | translate"
          >
          @if (registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched) {
            <span class="form-group__error">
              @if (registerForm.get('lastName')?.errors?.['required']) {
                {{ 'auth.signup.lastNameRequired' | translate }}
              } @else if (registerForm.get('lastName')?.errors?.['minlength']) {
                {{ 'auth.signup.minChars' | translate }}
              } @else if (registerForm.get('lastName')?.errors?.['invalidName']) {
                {{ 'auth.signup.specialCharsNotAllowed' | translate }}
              }
            </span>
          }
        </div>
      </div>

      <div class="form-group">
        <label class="form-group__label" for="email">{{ 'auth.signup.email' | translate }}</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="input"
          [class.input--error]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
          [placeholder]="'auth.signup.emailPlaceholder' | translate"
        >
        @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
          <span class="form-group__error">{{ 'auth.errors.invalidEmail' | translate }}</span>
        }
      </div>

      <div class="form-group">
        <label class="form-group__label" for="password">{{ 'auth.signup.password' | translate }}</label>
        <div class="input-password-wrapper">
          <input
            [type]="showPassword() ? 'text' : 'password'"
            id="password"
            formControlName="password"
            class="input"
            [class.input--error]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
            [placeholder]="'auth.signup.passwordPlaceholder' | translate"
          >
          <button
            type="button"
            class="password-toggle"
            (click)="togglePassword()"
            [attr.aria-label]="showPassword() ? ('auth.login.hidePassword' | translate) : ('auth.login.showPassword' | translate)"
            [attr.aria-pressed]="showPassword()"
          >
            @if (showPassword()) {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
              </svg>
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            }
          </button>
        </div>
        @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
          <span class="form-group__error">{{ 'auth.errors.passwordTooShort' | translate }}</span>
        }
      </div>

      @if (selectedRole() === 'STUDENT') {
        <div class="student-fields">
          <div class="form-group">
            <label class="form-group__label" for="birthDate">{{ 'auth.signup.birthDate' | translate }}</label>
            <app-date-input
              formControlName="birthDate"
              [min]="'1920-01-01'"
              [max]="maxBirthDate"
            ></app-date-input>
          </div>

          <div class="form-group">
            <label class="checkbox">
              <input type="checkbox" formControlName="knowsElo">
              <span>{{ 'auth.signup.knowsElo' | translate }}</span>
            </label>
          </div>

          <div class="elo-field-container">
            @if (registerForm.get('knowsElo')?.value) {
              <div class="form-group elo-field">
                <label class="form-group__label" for="eloRating">{{ 'auth.signup.eloRating' | translate }}</label>
                <input
                  type="number"
                  id="eloRating"
                  formControlName="eloRating"
                  class="input"
                  min="100"
                  max="3000"
                  [placeholder]="'auth.signup.eloPlaceholder' | translate"
                >
                <small class="form-hint">{{ 'auth.signup.eloHint' | translate }}</small>
              </div>
            }
          </div>
        </div>
      }

      @if (selectedRole() === 'TEACHER') {
        <div class="teacher-fields">
          <div class="form-group">
            <label class="form-group__label" for="hourlyRate">{{ 'auth.signup.hourlyRate' | translate }} ({{ 'auth.signup.hourlyRateUnit' | translate }})</label>
            <input
              type="number"
              id="hourlyRate"
              formControlName="hourlyRate"
              class="input"
              min="10"
              step="5"
              placeholder="50"
            >
          </div>

          <div class="form-group">
            <label class="form-group__label" for="bio">{{ 'auth.signup.bio' | translate }} <span class="required">*</span></label>
            <textarea
              id="bio"
              formControlName="bio"
              class="textarea"
              [class.input--error]="registerForm.get('bio')?.invalid && registerForm.get('bio')?.touched"
              rows="3"
              [placeholder]="'auth.signup.bioPlaceholder' | translate"
            ></textarea>
            @if (registerForm.get('bio')?.invalid && registerForm.get('bio')?.touched) {
              <span class="form-group__error">
                @if (registerForm.get('bio')?.errors?.['required']) {
                  {{ 'auth.signup.bioRequiredError' | translate }}
                } @else if (registerForm.get('bio')?.errors?.['minlength']) {
                  {{ 'auth.signup.minChars20' | translate }}
                }
              </span>
            }
          </div>

          <div class="form-group">
            <label class="form-group__label" id="languages-label">{{ 'auth.signup.languages' | translate }}</label>
            <div class="language-selector" role="group" aria-labelledby="languages-label">
              @for (lang of availableLanguages; track lang.code) {
                <button
                  type="button"
                  class="language-btn"
                  [class.language-btn--active]="isLanguageSelected(lang.code)"
                  [attr.aria-pressed]="isLanguageSelected(lang.code)"
                  (click)="toggleLanguage(lang.code)"
                >
                  {{ lang.name }}
                </button>
              }
            </div>
            <small class="form-hint">{{ 'auth.signup.languagesHint' | translate }}</small>
          </div>
        </div>
      }

      <button
        type="submit"
        class="btn btn--primary btn--block btn--lg"
        [disabled]="loading()"
      >
        @if (loading()) {
          <span class="spinner spinner--sm"></span>
          {{ 'auth.signup.submitting' | translate }}
        } @else {
          {{ 'auth.signup.submit' | translate }}
        }
      </button>
    </form>

    <div class="auth-card__footer">
      <p>
        {{ 'auth.signup.hasAccount' | translate }}
        <a routerLink="/login" class="text-gold">{{ 'auth.signup.login' | translate }}</a>
      </p>
    </div>
    }
  </div>
</div>
