<div class="profile-page">
  <nav class="navbar">
    <div class="container navbar__inner">
      <a routerLink="/" class="navbar__logo">
        <img src="assets/logo.png" alt="mychess" class="navbar__logo-img">
      </a>
      <div class="navbar__actions">
        <a routerLink="/teachers" class="btn btn--ghost">Retour</a>
      </div>
    </div>
  </nav>

  <main class="container">
    @if (teacherService.selectedTeacher(); as teacher) {
      <div class="contact-card">
        <!-- Header with gradient background -->
        <div class="contact-card__header">
          <div class="contact-card__avatar">
            @if (teacher.avatarUrl) {
              <img [src]="teacher.avatarUrl" [alt]="teacher.firstName">
            } @else {
              <span class="contact-card__initials">{{ getInitials(teacher.firstName, teacher.lastName) }}</span>
            }
          </div>
          <h1 class="contact-card__name">{{ teacher.firstName }} {{ teacher.lastName }}</h1>
          <p class="contact-card__title">Coach d'échecs</p>
          @if (teacher.isOnline) {
            <span class="contact-card__status">
              <span class="status-dot"></span>
              En ligne
            </span>
          }
        </div>

        <!-- Action buttons row -->
        @if (authService.isStudent()) {
          <div class="contact-card__actions">
            <a [routerLink]="['/book', teacher.id]" class="action-btn action-btn--primary">
              <span class="action-btn__icon">&#128197;</span>
              <span class="action-btn__label">Réserver</span>
            </a>
            <button
              class="action-btn"
              [class.action-btn--active]="isFavorite()"
              (click)="toggleFavorite()"
            >
              <span class="action-btn__icon">{{ isFavorite() ? '&#9733;' : '&#9734;' }}</span>
              <span class="action-btn__label">{{ isFavorite() ? 'Favori' : 'Ajouter' }}</span>
            </button>
          </div>
        } @else {
          <div class="contact-card__actions contact-card__actions--single">
            <a [routerLink]="['/book', teacher.id]" class="action-btn action-btn--primary action-btn--large">
              <span class="action-btn__icon">&#128197;</span>
              <span class="action-btn__label">Réserver un cours</span>
            </a>
          </div>
        }

        <!-- Info sections -->
        <div class="contact-card__sections">
          <!-- Tarif -->
          <div class="info-section">
            <div class="info-row">
              <span class="info-row__label">Tarif horaire</span>
              <span class="info-row__value info-row__value--gold">{{ formatPrice(teacher.hourlyRateCents) }}</span>
            </div>
          </div>

          <!-- Stats -->
          @if (teacher.lessonsCompleted || teacher.totalStudents || teacher.averageRating) {
            <div class="info-section">
              @if (teacher.averageRating) {
                <div class="info-row">
                  <span class="info-row__label">Note moyenne</span>
                  <span class="info-row__value">
                    <span class="star">&#9733;</span>
                    {{ teacher.averageRating.toFixed(1) }}
                    <span class="text-muted">({{ teacher.reviewCount }} avis)</span>
                  </span>
                </div>
              }
              @if (teacher.lessonsCompleted) {
                <div class="info-row">
                  <span class="info-row__label">Cours donnés</span>
                  <span class="info-row__value">{{ teacher.lessonsCompleted }}</span>
                </div>
              }
              @if (teacher.totalStudents) {
                <div class="info-row">
                  <span class="info-row__label">Élèves</span>
                  <span class="info-row__value">{{ teacher.totalStudents }}</span>
                </div>
              }
            </div>
          }

          <!-- Languages -->
          @if (teacher.languages && teacher.languages.length > 0) {
            <div class="info-section">
              <div class="info-row">
                <span class="info-row__label">Langues</span>
                <span class="info-row__value">
                  @for (lang of teacher.languages; track lang; let last = $last) {
                    {{ lang }}{{ !last ? ', ' : '' }}
                  }
                </span>
              </div>
            </div>
          }

          <!-- Bio -->
          @if (teacher.bio) {
            <div class="info-section info-section--bio">
              <span class="info-section__title">À propos</span>
              <p class="info-section__text">{{ teacher.bio }}</p>
            </div>
          }

          <!-- Email notifications toggle (disabled for non-Premium) -->
          @if (authService.isStudent() && isFavorite()) {
            <div class="info-section">
              <div class="info-row info-row--toggle">
                <span class="info-row__label">Alertes email</span>
                @if (paymentService.hasActiveSubscription()) {
                  <label class="toggle" (click)="toggleNotifications(); $event.preventDefault()">
                    <input type="checkbox" [checked]="notifyEnabled()">
                    <span class="toggle__slider"></span>
                  </label>
                } @else {
                  <label class="toggle toggle--disabled">
                    <input type="checkbox" disabled>
                    <span class="toggle__slider"></span>
                  </label>
                }
              </div>
              @if (paymentService.hasActiveSubscription()) {
                <p class="info-section__hint">Recevoir un email quand ce coach publie des créneaux</p>
              } @else {
                <p class="info-section__hint info-section__hint--premium">
                  <a routerLink="/subscription">Passez Premium</a> pour recevoir les alertes de disponibilités
                </p>
              }
            </div>
          }
        </div>
      </div>
    } @else {
      <div class="loading-state">
        <span class="spinner spinner--lg"></span>
      </div>
    }
  </main>
</div>
