<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="rating-modal-title" appFocusTrap>
    <div class="modal__header">
      <h2 id="rating-modal-title">{{ 'rating.title' | translate }}</h2>
      <button type="button" class="modal__close" (click)="onClose()" [attr.aria-label]="'common.close' | translate">&times;</button>
    </div>

    <div class="modal__body">
      <p class="teacher-name">{{ 'rating.subtitle' | translate }} <strong>{{ teacherName }}</strong></p>

      <div class="alert-inline-container" aria-live="polite">
        <div class="alert-inline alert-inline--error" [class.alert-inline--visible]="error()" role="alert">
          <span>{{ error() }}</span>
        </div>
      </div>

      <div class="stars-container">
        <p class="stars-label" id="stars-label">{{ 'rating.yourRating' | translate }}</p>
        <div class="stars" role="radiogroup" aria-labelledby="stars-label" (mouseleave)="clearHoveredStars()">
          @for (star of [1, 2, 3, 4, 5]; track star) {
            <button
              type="button"
              class="star-btn"
              role="radio"
              [class.star-btn--filled]="star <= getDisplayStars()"
              [attr.aria-checked]="selectedStars() === star"
              [attr.aria-label]="star + ' ' + ('rating.star' | translate) + (star > 1 ? 's' : '')"
              (mouseenter)="setHoveredStars(star)"
              (click)="selectStars(star)"
            >
              &#9733;
            </button>
          }
        </div>
        <p class="stars-text" aria-live="polite">
          @switch (getDisplayStars()) {
            @case (1) { {{ 'rating.stars.1' | translate }} }
            @case (2) { {{ 'rating.stars.2' | translate }} }
            @case (3) { {{ 'rating.stars.3' | translate }} }
            @case (4) { {{ 'rating.stars.4' | translate }} }
            @case (5) { {{ 'rating.stars.5' | translate }} }
            @default { {{ 'rating.selectRating' | translate }} }
          }
        </p>
      </div>

      <div class="form-group">
        <label class="form-group__label" for="comment">{{ 'rating.comment' | translate }}</label>
        <textarea
          id="comment"
          [(ngModel)]="comment"
          class="textarea"
          rows="4"
          [placeholder]="'rating.commentPlaceholder' | translate"
        ></textarea>
      </div>
    </div>

    <div class="modal__footer">
      <button type="button" class="btn btn--ghost" (click)="onClose()">{{ 'common.cancel' | translate }}</button>
      <button
        type="button"
        class="btn btn--primary"
        [disabled]="loading() || selectedStars() === 0"
        (click)="onSubmit()"
      >
        @if (loading()) {
          <span class="spinner spinner--sm" aria-hidden="true"></span>
          {{ 'rating.submitting' | translate }}
        } @else {
          {{ 'rating.submit' | translate }}
        }
      </button>
    </div>
  </div>
</div>
