<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="rating-modal-title" appFocusTrap>
    <div class="modal__header">
      <h2 id="rating-modal-title">Évaluer votre cours</h2>
      <button type="button" class="modal__close" (click)="onClose()" aria-label="Fermer">&times;</button>
    </div>

    <div class="modal__body">
      <p class="teacher-name">Cours avec <strong>{{ teacherName }}</strong></p>

      <div class="alert-inline-container" aria-live="polite">
        <div class="alert-inline alert-inline--error" [class.alert-inline--visible]="error()" role="alert">
          <span>{{ error() }}</span>
        </div>
      </div>

      <div class="stars-container">
        <p class="stars-label" id="stars-label">Votre note :</p>
        <div class="stars" role="radiogroup" aria-labelledby="stars-label" (mouseleave)="clearHoveredStars()">
          @for (star of [1, 2, 3, 4, 5]; track star) {
            <button
              type="button"
              class="star-btn"
              role="radio"
              [class.star-btn--filled]="star <= getDisplayStars()"
              [attr.aria-checked]="selectedStars() === star"
              [attr.aria-label]="star + ' étoile' + (star > 1 ? 's' : '')"
              (mouseenter)="setHoveredStars(star)"
              (click)="selectStars(star)"
            >
              &#9733;
            </button>
          }
        </div>
        <p class="stars-text" aria-live="polite">
          @switch (getDisplayStars()) {
            @case (1) { Mauvais }
            @case (2) { Passable }
            @case (3) { Bien }
            @case (4) { Très bien }
            @case (5) { Excellent }
            @default { Sélectionnez une note }
          }
        </p>
      </div>

      <div class="form-group">
        <label class="form-group__label" for="comment">Commentaire (optionnel)</label>
        <textarea
          id="comment"
          [(ngModel)]="comment"
          class="textarea"
          rows="4"
          placeholder="Partagez votre expérience avec ce coach..."
        ></textarea>
      </div>
    </div>

    <div class="modal__footer">
      <button type="button" class="btn btn--ghost" (click)="onClose()">Annuler</button>
      <button
        type="button"
        class="btn btn--primary"
        [disabled]="loading() || selectedStars() === 0"
        (click)="onSubmit()"
      >
        @if (loading()) {
          <span class="spinner spinner--sm" aria-hidden="true"></span>
          Envoi...
        } @else {
          Envoyer mon avis
        }
      </button>
    </div>
  </div>
</div>
